# üöó Gu√≠a Completa del Flujo del WebDriver

**Autor:** Framework Pytest - Selenium
**√öltima actualizaci√≥n:** Octubre 2024
**Objetivo:** Entender el flujo completo desde la creaci√≥n del driver hasta su uso en tests

---

## üìã Tabla de Contenidos

1. [Visi√≥n General](#visi√≥n-general)
2. [Arquitectura del Sistema](#arquitectura-del-sistema)
3. [Flujo Completo Paso a Paso](#flujo-completo-paso-a-paso)
4. [Componentes Principales](#componentes-principales)
5. [C√≥digo en Detalle](#c√≥digo-en-detalle)
6. [FAQ - Preguntas Frecuentes](#faq---preguntas-frecuentes)
7. [Ejemplos Pr√°cticos](#ejemplos-pr√°cticos)

---

## üéØ Visi√≥n General

El framework utiliza un **patr√≥n de capas** para gestionar WebDriver:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CAPAS DEL FRAMEWORK                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1. TESTS (test_login.py)                                   ‚îÇ
‚îÇ     ‚îî‚îÄ Usa: self.driver                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  2. PYTEST INTEGRATION (conftest.py)                        ‚îÇ
‚îÇ     ‚îî‚îÄ Fixtures, CLI options, parametrizaci√≥n               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  3. DRIVER MANAGEMENT (drivers/driver_manager.py)           ‚îÇ
‚îÇ     ‚îî‚îÄ Configuraci√≥n, timeouts, navegaci√≥n                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  4. BROWSER CREATION (drivers/browser_factory.py)           ‚îÇ
‚îÇ     ‚îî‚îÄ Creaci√≥n de Chrome, Firefox, Edge                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  5. SELENIUM WEBDRIVER                                      ‚îÇ
‚îÇ     ‚îî‚îÄ selenium.webdriver.chrome/firefox/edge               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üèóÔ∏è Arquitectura del Sistema

### Separaci√≥n de Responsabilidades

| Componente | Archivo | Responsabilidad | ¬øPor qu√© existe? |
|------------|---------|-----------------|------------------|
| **BrowserFactory** | `drivers/browser_factory.py` | Crear drivers crudos (Chrome, Firefox, Edge) | Factory Pattern - Centraliza la creaci√≥n |
| **DriverManager** | `drivers/driver_manager.py` | Configurar driver (timeouts, navegaci√≥n, cleanup) | Simplifica la gesti√≥n del ciclo de vida |
| **conftest.py** | `conftest.py` | Integraci√≥n con pytest (fixtures, CLI, parametrizaci√≥n) | Pytest-specific - No puede estar en DriverManager |
| **BaseTest** | `tests/base_test.py` | Clase base con fixture `initialize_driver` | DRY - Evita repetir `@pytest.mark.usefixtures` en cada test |

### Diagrama de Dependencias

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DEPENDENCIAS                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

test_login.py
    ‚îÇ
    ‚îú‚îÄ Hereda: BaseTest
    ‚îÇ           ‚îÇ
    ‚îÇ           ‚îî‚îÄ Usa fixture: initialize_driver (de conftest.py)
    ‚îÇ
    ‚îî‚îÄ Usa: LoginPage(self.driver)


conftest.py
    ‚îÇ
    ‚îú‚îÄ Importa: DriverManager
    ‚îÇ            ‚îÇ
    ‚îÇ            ‚îú‚îÄ Importa: BrowserFactory
    ‚îÇ            ‚îÇ            ‚îÇ
    ‚îÇ            ‚îÇ            ‚îî‚îÄ Importa: selenium.webdriver
    ‚îÇ            ‚îÇ
    ‚îÇ            ‚îî‚îÄ Importa: EnvironmentConfig
    ‚îÇ
    ‚îî‚îÄ Define: Fixtures (initialize_driver, config, base_url)
```

---

## üîÑ Flujo Completo Paso a Paso

### Comando Inicial

```bash
pytest tests/test_login.py --browser=chrome --env=dev --headless
```

### Paso 1: Pytest Detecta el Test

```python
# tests/test_login.py:26
@pytest.mark.smoke
class TestLogin(BaseTest):  # ‚Üê Hereda de BaseTest
    def test_valid_credentials(self):
        ...
```

### Paso 2: Herencia de BaseTest

```python
# tests/base_test.py:5-7
@pytest.mark.usefixtures("initialize_driver")  # ‚Üê Activa el fixture
class BaseTest:
    driver: WebDriver  # ‚Üê Declaraci√≥n de tipo (inyectado despu√©s)
```

**¬øQu√© hace `@pytest.mark.usefixtures`?**
- Le dice a pytest: "Antes de ejecutar cualquier test de esta clase, ejecuta el fixture `initialize_driver`"
- Es como un `@BeforeClass` en JUnit/TestNG

### Paso 3: Pytest Ejecuta el Fixture

```python
# conftest.py:120-181
@pytest.fixture
def initialize_driver(
    request,
    config: EnvironmentConfig,      # ‚Üê Inyectado por pytest
    base_url: str,                  # ‚Üê Inyectado por pytest
    browser_name: str               # ‚Üê De parametrizaci√≥n
) -> Generator[WebDriver, None, None]:
    """
    Este fixture se ejecuta ANTES de cada test.
    """
    headless = request.config.getoption("--headless")

    # ========================================
    # PUNTO CLAVE 1: Crear DriverManager
    # ========================================
    manager = DriverManager(
        browser=browser_name,    # "chrome"
        config=config,           # EnvironmentConfig(base_url="...", timeouts=...)
        headless=headless        # True/False
    )

    # ========================================
    # PUNTO CLAVE 2: Driver ya est√° listo
    # ========================================
    driver = manager.driver  # ‚Üê Driver creado y configurado en __init__

    # ========================================
    # PUNTO CLAVE 3: Inyecci√≥n a la clase
    # ========================================
    request.cls.driver = driver  # ‚Üê Inyecta driver a self.driver

    # Logs para debugging
    print(f"\n{'='*70}")
    print(f"üåç Environment: {config.environment.upper()}")
    print(f"üåê Browser: {browser_name.upper()} {'(Headless)' if headless else ''}")
    print(f"üîó Base URL: {base_url}")
    print(f"‚è±Ô∏è  Timeouts: {config.implicit_wait}s implicit | {config.page_load_timeout}s page load")
    print(f"{'='*70}")

    # ========================================
    # El test se ejecuta aqu√≠ (yield)
    # ========================================
    yield driver

    # ========================================
    # TEARDOWN: Despu√©s del test
    # ========================================
    print(f"\n{'='*70}")
    print(f"üßπ [Teardown] Closing {browser_name} driver...")
    print(f"{'='*70}")
    manager.quit()  # ‚Üê Limpieza (driver.quit())
```

### Paso 4: ¬øQu√© Hace `DriverManager.__init__()`?

**Ubicaci√≥n:** `drivers/driver_manager.py:25-56`

```python
def __init__(self, browser: str, config: EnvironmentConfig, headless: bool = False, **browser_options):
    """
    ESTE ES EL CONSTRUCTOR QUE CREA Y CONFIGURA TODO.
    """

    # ====================================================================
    # PASO 4.1: Crear driver via BrowserFactory
    # ====================================================================
    self.driver = BrowserFactory.create(
        browser=browser,      # "chrome"
        headless=headless,    # True/False
        **browser_options     # Opciones adicionales
    )
    # Resultado: self.driver = <selenium.webdriver.Chrome instance>

    # ====================================================================
    # PASO 4.2: Aplicar timeouts del ambiente
    # ====================================================================
    # Implicit wait: tiempo de espera para encontrar elementos
    self.driver.implicitly_wait(config.implicit_wait)  # 10 segundos

    # Page load timeout: tiempo m√°ximo para cargar una p√°gina
    self.driver.set_page_load_timeout(config.page_load_timeout)  # 30 segundos

    # ====================================================================
    # PASO 4.3: Navegar a la URL base
    # ====================================================================
    self.driver.get(config.base_url)  # https://tutorialsninja.com/demo

    # ====================================================================
    # PASO 4.4: Maximizar ventana (consistencia)
    # ====================================================================
    self.driver.maximize_window()
```

### Paso 5: ¬øQu√© Hace `BrowserFactory.create()`?

**Ubicaci√≥n:** `drivers/browser_factory.py:30-60` (aprox)

```python
@staticmethod
def create(browser: str, headless: bool = False, **options) -> WebDriver:
    """
    Factory Method Pattern:
    - Centraliza la l√≥gica de creaci√≥n
    - Oculta detalles de implementaci√≥n
    """
    browser = browser.lower()

    if browser == "chrome":
        # Crear opciones de Chrome
        chrome_options = ChromeOptions()
        if headless:
            chrome_options.add_argument("--headless=new")
            chrome_options.add_argument("--disable-gpu")
        chrome_options.add_argument("--no-sandbox")
        chrome_options.add_argument("--disable-dev-shm-usage")

        # Crear servicio (maneja el chromedriver)
        service = ChromeService()

        # ¬°CREAR EL DRIVER!
        driver = webdriver.Chrome(service=service, options=chrome_options)
        return driver

    elif browser == "firefox":
        # Similar para Firefox...
        pass

    elif browser == "edge":
        # Similar para Edge...
        pass

    else:
        raise ValueError(f"Browser '{browser}' not supported")
```

### Paso 6: Test Usa `self.driver`

```python
# tests/test_login.py:34-52
def test_valid_credentials(self):
    """
    En este punto, self.driver YA EXISTE (fue inyectado en Paso 3)
    """
    # ‚úÖ self.driver est√° disponible (WebDriver configurado)
    login_page = LoginPage(self.driver)

    # Usar Page Object
    login_page.set_email_address(TestData.email)
    login_page.set_password(TestData.password)
    my_account_page = login_page.click_login_button()

    # Assertions
    assert my_account_page.get_title() == "My Account"
```

### Paso 7: Teardown (Limpieza)

```python
# conftest.py:168-172
yield driver  # ‚Üê El test se ejecuta aqu√≠

# Despu√©s del test (√©xito o fallo):
manager.quit()  # ‚Üê Llama a driver.quit()
```

**¬øQu√© hace `manager.quit()`?**

**Ubicaci√≥n:** `drivers/driver_manager.py:58-70`

```python
def quit(self) -> None:
    """
    Limpieza segura del driver.
    """
    if hasattr(self, 'driver') and self.driver:
        try:
            self.driver.quit()  # ‚Üê Cierra el navegador
        except Exception as e:
            # Log pero no falla el test
            print(f"Warning: Error during driver cleanup: {e}")
        finally:
            self.driver = None
```

---

## üß© Componentes Principales

### 1. DriverManager (`drivers/driver_manager.py`)

**Responsabilidades:**
- Crear y configurar el WebDriver inmediatamente
- Configurar timeouts y navegaci√≥n
- Proveer cleanup seguro

**API P√∫blica:**

```python
class DriverManager:
    def __init__(self, browser: str, config: EnvironmentConfig, headless: bool = False):
        """Crea y configura el driver inmediatamente"""
        # self.driver est√° listo para usar

    def quit(self) -> None:
        """Cierra el driver de forma segura"""
```

**Ejemplo de Uso Standalone (sin pytest):**

```python
from drivers.driver_manager import DriverManager
from config.environment_manager import get_config

# Uso simple
config = get_config('dev')
manager = DriverManager('chrome', config, headless=True)
driver = manager.driver  # Ya est√° listo
try:
    driver.get("https://example.com")
    # ... hacer algo ...
finally:
    manager.quit()
```

### 2. BrowserFactory (`drivers/browser_factory.py`)

**Patr√≥n:** Factory Method Pattern

**Responsabilidades:**
- Crear drivers espec√≠ficos (Chrome, Firefox, Edge)
- Aplicar opciones espec√≠ficas del navegador
- Ocultar detalles de implementaci√≥n de Selenium

**API P√∫blica:**

```python
class BrowserFactory:
    @staticmethod
    def create(browser: str, headless: bool = False, **options) -> WebDriver:
        """
        Factory method para crear WebDriver.

        Args:
            browser: 'chrome', 'firefox', 'edge'
            headless: Modo sin interfaz gr√°fica
            **options: Opciones adicionales (prefs, binary_location, etc.)

        Returns:
            WebDriver configurado (sin timeouts ni navegaci√≥n)
        """
```

### 3. conftest.py (Pytest Integration)

**Patr√≥n:** Dependency Injection (via Pytest)

**Responsabilidades:**
- Definir fixtures de pytest
- Parsear CLI options (`--browser`, `--env`, `--headless`)
- Parametrizar tests para m√∫ltiples navegadores
- Integrar DriverManager con pytest

**Fixtures Principales:**

```python
@pytest.fixture(scope="session")
def config(request) -> EnvironmentConfig:
    """Carga configuraci√≥n del ambiente (dev/staging/prod)"""

@pytest.fixture(scope="session")
def base_url(config: EnvironmentConfig) -> str:
    """Retorna URL base del config"""

@pytest.fixture
def initialize_driver(request, config, base_url, browser_name) -> WebDriver:
    """Crea, configura y retorna driver; limpieza autom√°tica"""
```

**CLI Options:**

```python
def pytest_addoption(parser):
    """
    Agrega opciones de l√≠nea de comandos:
    - --browser: chrome, firefox, edge, all
    - --env: dev, staging, prod
    - --headless: modo sin UI
    """
```

### 4. BaseTest (`tests/base_test.py`)

**Patr√≥n:** Template Method Pattern

**Responsabilidad:**
- Proveer clase base para todos los tests
- Evitar repetir `@pytest.mark.usefixtures` en cada clase

```python
@pytest.mark.usefixtures("initialize_driver")
class BaseTest:
    driver: WebDriver  # Type hint (inyectado por fixture)
```

**Uso en Tests:**

```python
class TestLogin(BaseTest):  # ‚Üê Hereda fixture autom√°ticamente
    def test_something(self):
        self.driver.get("...")  # ‚úÖ driver disponible
```

---

## üíª C√≥digo en Detalle

### Ejemplo Completo de Ejecuci√≥n

```python
# ============================================================================
# COMANDO
# ============================================================================
pytest tests/test_login.py::TestLogin::test_valid_credentials --browser=chrome --env=dev

# ============================================================================
# PASO 1: pytest_addoption (conftest.py:29-54)
# ============================================================================
# Parsea: --browser=chrome --env=dev
# Resultado:
#   request.config.getoption("--browser") ‚Üí "chrome"
#   request.config.getoption("--env") ‚Üí "dev"

# ============================================================================
# PASO 2: pytest_generate_tests (conftest.py:94-113)
# ============================================================================
# Parametriza test con browser_name="chrome"

# ============================================================================
# PASO 3: Fixture 'config' (conftest.py:61-74)
# ============================================================================
env_name = "dev"  # De --env
config = get_config(env_name)
# Resultado:
#   config.environment = "dev"
#   config.base_url = "https://tutorialsninja.com/demo"
#   config.implicit_wait = 10
#   config.page_load_timeout = 30

# ============================================================================
# PASO 4: Fixture 'initialize_driver' (conftest.py:120-181)
# ============================================================================
browser_name = "chrome"  # De parametrizaci√≥n
headless = False         # No se pas√≥ --headless

# 4.1: Crear DriverManager
manager = DriverManager(
    browser="chrome",
    config=config,
    headless=False
)

# 4.2: Driver ya est√° creado y configurado
driver = manager.driver  # Ya listo (creado en __init__)

# 4.3: Inyectar a clase
request.cls.driver = driver
# Ahora: TestLogin.driver = <selenium.webdriver.Chrome>

# ============================================================================
# PASO 5: DriverManager.__init__() (driver_manager.py:25-56)
# ============================================================================

# 5.1: Crear driver
self.driver = BrowserFactory.create(
    browser="chrome",
    headless=False
)
# ‚Üê ¬°VER PASO 6!

# 5.2: Configurar timeouts
self.driver.implicitly_wait(10)  # config.implicit_wait
self.driver.set_page_load_timeout(30)  # config.page_load_timeout

# 5.3: Navegar a base URL
self.driver.get("https://tutorialsninja.com/demo")  # config.base_url

# 5.4: Maximizar ventana
self.driver.maximize_window()

# ============================================================================
# PASO 6: BrowserFactory.create() (browser_factory.py)
# ============================================================================

# 6.1: Crear opciones
chrome_options = ChromeOptions()
chrome_options.add_argument("--no-sandbox")
chrome_options.add_argument("--disable-dev-shm-usage")

# 6.2: Crear servicio
service = ChromeService()

# 6.3: Crear driver RAW
driver = webdriver.Chrome(service=service, options=chrome_options)
# Resultado: <selenium.webdriver.Chrome (session="abc123")>

# 6.4: Retornar
return driver

# ============================================================================
# PASO 7: Test se ejecuta (test_login.py:34-66)
# ============================================================================
def test_valid_credentials(self):
    # self.driver = <selenium.webdriver.Chrome> (inyectado en Paso 4.3)

    login_page = LoginPage(self.driver)
    login_page.set_email_address("daniel@gmail.com")
    login_page.set_password("daniel12345")
    my_account_page = login_page.click_login_button()

    # Assertions
    assert my_account_page.get_title() == "My Account"
    assert "account/account" in my_account_page.get_current_url()

# ============================================================================
# PASO 8: Teardown (conftest.py:177-181)
# ============================================================================
# Fixture hace yield, test termina, ahora ejecuta cleanup

manager.quit()

# ============================================================================
# PASO 9: manager.quit() (driver_manager.py:58-70)
# ============================================================================
if hasattr(self, 'driver') and self.driver:
    try:
        self.driver.quit()  # Cierra navegador
    except Exception as e:
        print(f"Warning: Error during cleanup: {e}")
    finally:
        self.driver = None

# ============================================================================
# FIN
# ============================================================================
```

---

## ‚ùì FAQ - Preguntas Frecuentes

### ‚ùì ¬øPor qu√© existe DriverManager si ya hay fixture en conftest?

**Respuesta:** Separaci√≥n de responsabilidades (Single Responsibility Principle)

| Sin DriverManager | Con DriverManager |
|-------------------|-------------------|
| `conftest.py` tendr√≠a 100+ l√≠neas mezclando pytest con l√≥gica de driver | `conftest.py` tiene solo 15 l√≠neas para el fixture |
| No reutilizable fuera de pytest | DriverManager es reutilizable en scripts standalone |
| Dif√≠cil de testear | F√°cil de testear (unit tests para DriverManager) |
| Viola SRP | Cada clase tiene una responsabilidad |

**Ejemplo sin DriverManager:**

```python
# ‚ùå TODO EN CONFTEST.PY (anti-pattern)
@pytest.fixture
def initialize_driver(config, browser_name, headless):
    # 50 l√≠neas creando driver
    if browser_name == "chrome":
        options = ChromeOptions()
        if headless:
            options.add_argument("--headless")
        service = ChromeService()
        driver = webdriver.Chrome(service=service, options=options)
    elif browser_name == "firefox":
        # ... m√°s c√≥digo duplicado ...

    # 30 l√≠neas configurando timeouts
    driver.implicitly_wait(config.implicit_wait)
    driver.set_page_load_timeout(config.page_load_timeout)
    driver.get(config.base_url)
    driver.maximize_window()

    yield driver

    # 10 l√≠neas de cleanup
    try:
        driver.quit()
    except:
        pass
```

**Con DriverManager:**

```python
# ‚úÖ LIMPIO Y MANTENIBLE
@pytest.fixture
def initialize_driver(config, browser_name, headless):
    manager = DriverManager(browser_name, config, headless)
    request.cls.driver = manager.driver
    yield manager.driver
    manager.quit()
```

---

### ‚ùì ¬øD√≥nde exactamente se crea la instancia del driver?

**Respuesta:** En `BrowserFactory.create()` l√≠nea ~50 (aprox)

```python
# drivers/browser_factory.py
driver = webdriver.Chrome(service=service, options=chrome_options)
```

**Traza de llamadas:**

```
conftest.py:initialize_driver()
    ‚îî‚îÄ manager.start()                     [driver_manager.py:84]
        ‚îî‚îÄ BrowserFactory.create()         [browser_factory.py:30]
            ‚îî‚îÄ webdriver.Chrome()          [selenium/webdriver/chrome/webdriver.py]
                ‚îî‚îÄ ChromeDriver.exe        [OS process]
```

---

### ‚ùì ¬øC√≥mo llega `driver` a `self.driver` en los tests?

**Respuesta:** Inyecci√≥n via `request.cls.driver`

```python
# conftest.py:164
request.cls.driver = driver

# Explicaci√≥n:
# - request: objeto pytest que contiene metadata del test
# - request.cls: la clase del test (ej: TestLogin)
# - request.cls.driver = driver: asigna driver como atributo de clase

# Equivalente a:
TestLogin.driver = driver

# Por eso funciona:
class TestLogin(BaseTest):
    def test_something(self):
        self.driver.get("...")  # ‚úÖ Funciona
```

---

### ‚ùì ¬øPuedo usar DriverManager sin pytest?

**Respuesta:** ¬°S√≠! Es completamente independiente.

```python
# script_standalone.py
from drivers.driver_manager import DriverManager
from config.environment_manager import get_config

# Cargar config
config = get_config('prod')

# Uso simple
manager = DriverManager('firefox', config, headless=True)
driver = manager.driver
try:
    driver.get("https://example.com")
    title = driver.title
    print(f"Title: {title}")
finally:
    manager.quit()
```

---

### ‚ùì ¬øQu√© pasa si no heredo de BaseTest?

**Respuesta:** Debes usar el fixture manualmente.

```python
# Opci√≥n 1: Heredar de BaseTest (recomendado)
class TestLogin(BaseTest):
    def test_something(self):
        self.driver.get("...")  # ‚úÖ Funciona

# Opci√≥n 2: Usar fixture manualmente
class TestStandalone:  # No hereda de BaseTest
    def test_something(self, initialize_driver):
        # initialize_driver es el driver (fixture retorna WebDriver)
        initialize_driver.get("...")  # ‚úÖ Funciona

# Opci√≥n 3: Marcar clase manualmente
@pytest.mark.usefixtures("initialize_driver")
class TestManual:
    driver: WebDriver

    def test_something(self):
        self.driver.get("...")  # ‚úÖ Funciona
```

---

### ‚ùì ¬øPor qu√© `yield` en el fixture?

**Respuesta:** Permite separar setup y teardown.

```python
@pytest.fixture
def initialize_driver(...):
    # ========== SETUP (antes del test) ==========
    manager = DriverManager(...)
    driver = manager.start()
    request.cls.driver = driver

    # ========== TEST SE EJECUTA AQU√ç ==========
    yield driver  # ‚Üê Pausa aqu√≠, ejecuta test, luego contin√∫a

    # ========== TEARDOWN (despu√©s del test) ==========
    manager.quit()
    # Se ejecuta INCLUSO si el test falla
```

**Alternativa sin yield (antiguo):**

```python
# ‚ùå ANTIGUO (pytest < 3.0)
@pytest.fixture
def driver_old(request):
    driver = webdriver.Chrome()

    def teardown():
        driver.quit()

    request.addfinalizer(teardown)
    return driver
```

---

### ‚ùì ¬øQu√© es `scope="session"` en fixture config?

**Respuesta:** Define cu√°ntas veces se ejecuta el fixture.

| Scope | Ejecuci√≥n | Ejemplo |
|-------|-----------|---------|
| `function` (default) | Una vez por test | Driver nuevo para cada test |
| `class` | Una vez por clase | Driver compartido en TestLogin |
| `module` | Una vez por archivo | Driver compartido en test_login.py |
| `session` | Una vez por sesi√≥n pytest | Config cargado solo una vez |

```python
# conftest.py:61
@pytest.fixture(scope="session")  # ‚Üê Se ejecuta 1 vez para toda la sesi√≥n
def config(request) -> EnvironmentConfig:
    env_name = request.config.getoption("--env")
    return get_config(env_name)  # Carga config solo 1 vez

# ¬øPor qu√©?
# - Cargar config es costoso (leer .env, validar, etc.)
# - Config no cambia durante la ejecuci√≥n
# - Mejora performance
```

---

### ‚ùì ¬øQu√© es `browser_name` en initialize_driver?

**Respuesta:** Viene de la parametrizaci√≥n din√°mica.

```python
# conftest.py:94-113
def pytest_generate_tests(metafunc):
    """
    Hook de pytest que se ejecuta ANTES de colectar tests.
    Genera variantes del test para diferentes navegadores.
    """
    if "initialize_driver" in metafunc.fixturenames:
        browser_option = metafunc.config.getoption("--browser").lower()

        if browser_option == "all":
            browsers = ["chrome", "firefox", "edge"]
        else:
            browsers = [browser_option]

        # Parametriza browser_name
        metafunc.parametrize("browser_name", browsers, indirect=False)

# Resultado:
# pytest --browser=chrome
#   ‚Üí browser_name = "chrome"
#   ‚Üí 1 test execution

# pytest --browser=all
#   ‚Üí browser_name = ["chrome", "firefox", "edge"]
#   ‚Üí 3 test executions (uno por navegador)
```

**Ejemplo de salida:**

```bash
$ pytest tests/test_login.py::TestLogin::test_valid_credentials --browser=all -v

tests/test_login.py::TestLogin::test_valid_credentials[chrome] PASSED
tests/test_login.py::TestLogin::test_valid_credentials[firefox] PASSED
tests/test_login.py::TestLogin::test_valid_credentials[edge] PASSED
```

---

## üîß Ejemplos Pr√°cticos

### Ejemplo 1: Ejecutar Test Simple

```bash
# Test en Chrome (default)
pytest tests/test_login.py::TestLogin::test_valid_credentials

# Test en Firefox
pytest tests/test_login.py::TestLogin::test_valid_credentials --browser=firefox

# Test en modo headless
pytest tests/test_login.py --browser=chrome --headless

# Test en staging
pytest tests/test_login.py --env=staging
```

### Ejemplo 2: Ejecutar en Todos los Navegadores

```bash
# Ejecuta el mismo test en Chrome, Firefox y Edge
pytest tests/test_login.py::TestLogin::test_valid_credentials --browser=all

# Output:
# test_valid_credentials[chrome] PASSED
# test_valid_credentials[firefox] PASSED
# test_valid_credentials[edge] PASSED
```

### Ejemplo 3: Debugging con Print Statements

```python
# tests/test_debug.py
class TestDebug(BaseTest):
    def test_check_driver(self):
        # Ver qu√© driver se cre√≥
        print(f"\nDriver type: {type(self.driver)}")
        print(f"Driver session: {self.driver.session_id}")
        print(f"Current URL: {self.driver.current_url}")

        # Ver capabilities
        caps = self.driver.capabilities
        print(f"Browser: {caps['browserName']}")
        print(f"Version: {caps['browserVersion']}")
```

### Ejemplo 4: Usar DriverManager en Script

```python
# scripts/scrape_data.py
"""
Script standalone para scraping sin pytest.
"""
from drivers.driver_manager import DriverManager
from config.environment_manager import get_config

def main():
    config = get_config('prod')

    manager = DriverManager('chrome', config, headless=True)
    driver = manager.driver
    try:
        driver.get("https://example.com")

        # Scraping logic
        elements = driver.find_elements(By.CSS_SELECTOR, ".item")
        for elem in elements:
            print(elem.text)
    finally:
        manager.quit()

if __name__ == "__main__":
    main()
```

### Ejemplo 5: Override de Configuraci√≥n

```python
# tests/test_custom_config.py
class TestCustomTimeout(BaseTest):
    def test_with_longer_timeout(self):
        # Override timeout para este test espec√≠fico
        self.driver.implicitly_wait(30)  # Override config (default: 10s)

        # Buscar elemento que tarda en cargar
        slow_element = self.driver.find_element(By.ID, "slow-loading")
        assert slow_element.is_displayed()
```

---

## üìä Diagramas de Secuencia

### Diagrama 1: Flujo Completo

```
Usuario              Pytest           conftest.py         DriverManager      BrowserFactory    Selenium
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ pytest test_login  ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ Detecta BaseTest   ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ @usefixtures()     ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>  ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ new DriverManager  ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ manager.start()    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ create("chrome") ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ new Chrome() ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ    driver    ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ      driver      ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ configure driver ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ (timeouts, nav)  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ       driver       ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ request.cls.driver = driver           ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ (inyecci√≥n)        ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ    yield driver    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ ejecuta test       ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ test usa self.driver                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ test termina       ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ manager.quit()     ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ driver.quit()    ‚îÇ              ‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
  ‚îÇ                    ‚îÇ                    ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
  ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
  ‚îÇ Test completo                          ‚îÇ                    ‚îÇ                  ‚îÇ              ‚îÇ
```

### Diagrama 2: Herencia y Fixtures

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HERENCIA DE FIXTURES                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

BaseTest (tests/base_test.py)
‚îú‚îÄ @pytest.mark.usefixtures("initialize_driver")
‚îú‚îÄ driver: WebDriver  (type hint)
‚îÇ
‚îú‚îÄ‚îÄ> TestLogin(BaseTest)  (hereda fixture)
‚îÇ    ‚îú‚îÄ test_valid_credentials(self)
‚îÇ    ‚îÇ   ‚îî‚îÄ self.driver ‚úÖ (inyectado por fixture)
‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ test_invalid_credentials(self)
‚îÇ        ‚îî‚îÄ self.driver ‚úÖ (inyectado por fixture)
‚îÇ
‚îú‚îÄ‚îÄ> TestChangePassword(BaseTest)  (hereda fixture)
‚îÇ    ‚îî‚îÄ test_change_password(self)
‚îÇ        ‚îî‚îÄ self.driver ‚úÖ (inyectado por fixture)
‚îÇ
‚îî‚îÄ‚îÄ> TestRegistration(BaseTest)  (hereda fixture)
     ‚îî‚îÄ test_register_user(self)
         ‚îî‚îÄ self.driver ‚úÖ (inyectado por fixture)


conftest.py
‚îú‚îÄ @pytest.fixture: initialize_driver
‚îÇ   ‚îî‚îÄ Ejecutado autom√°ticamente por @pytest.mark.usefixtures
‚îÇ
‚îú‚îÄ @pytest.fixture: config
‚îÇ   ‚îî‚îÄ Inyectado a initialize_driver
‚îÇ
‚îî‚îÄ @pytest.fixture: base_url
    ‚îî‚îÄ Inyectado a initialize_driver
```

---

## üéì Conclusiones

### Ventajas de esta Arquitectura

‚úÖ **Separaci√≥n de Responsabilidades**
- Cada componente tiene un prop√≥sito claro
- F√°cil de mantener y extender

‚úÖ **Reutilizaci√≥n**
- DriverManager funciona sin pytest
- BrowserFactory reutilizable en otros contextos

‚úÖ **Testabilidad**
- Componentes independientes = f√°ciles de testear
- Mocks f√°ciles de crear

‚úÖ **Escalabilidad**
- Agregar nuevo navegador: solo modificar BrowserFactory
- Agregar nuevo ambiente: solo modificar config/

‚úÖ **Legibilidad**
- Flujo claro y predecible
- Documentaci√≥n inline

### Flujo Resumido

```
pytest comando
    ‚Üì
Detecta BaseTest
    ‚Üì
Ejecuta fixture initialize_driver
    ‚Üì
Crea DriverManager
    ‚Üì
manager.start() ‚Üí BrowserFactory.create() ‚Üí webdriver.Chrome()
    ‚Üì
Configura driver (timeouts, navegaci√≥n)
    ‚Üì
Inyecta a self.driver
    ‚Üì
Test usa self.driver
    ‚Üì
Teardown: manager.quit() ‚Üí driver.quit()
```

---

## üìö Referencias

- **Pytest Fixtures:** https://docs.pytest.org/en/stable/fixture.html
- **Selenium WebDriver:** https://www.selenium.dev/documentation/webdriver/
- **Design Patterns:** https://refactoring.guru/design-patterns

---

**¬øPreguntas?** Revisa la secci√≥n [FAQ](#faq---preguntas-frecuentes) o consulta el c√≥digo fuente con los comentarios inline.